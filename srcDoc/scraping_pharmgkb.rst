.. _scraping_pharmgkb:

Scraping PharmGKB
*****************
The python web crawling framework `scrapy <http://scrapy.org/>`_ was used for scraping data from 
PharmGKB. The `scrapy documentation <http://doc.scrapy.org/>`_ provides a useful overview of scrapy 
basics.

This code belongs to the haplorec repo.

The pharmgkb Scraper
====================
The scraper does the following:

* :class:`.GeneDrugPairSpider`: Start at the `gene-drug pairs page 
  <http://www.pharmgkb.org/page/cpicGeneDrugPairs>`_  which lists gene-pages and drug-pages for 
  which there are CPIC guidelines.  Crawl to the gene-pages, since they will (possibly) contain drug 
  recommendations.

* :class:`.GeneSpider`:

  * Extract *gene_haplotype_variant* records from the "Haplotypes" tab of the gene-page

  * For each drug with a "Lookup your guideline" dialog:

    * :class:`.GeneHaplotypeSpider`: GET the json that generated that dialog, which contains the 
      haplotypes for this gene

    * For each haplotype pair, GET the drug recommendation:

      * :class:`.HaplotypeGenotypeSpider`: From the drug recommendation, extract a 
        *genotype_phenotype* record, a *drug_recommendation* record, and a 
        *genotype_drug_recommedation* record

API
===
Autogenerated api documentation is available :doc:`here <apidoc/modules>` 

Running The Scraper
===================
There is a Makefile target ``scrape`` (defined in scrapy_config.mk) for running the scraper, 
starting from http://www.pharmgkb.org/page/cpicGeneDrugPairs.
